!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";var o=n(2),i=n(3),r=doT.template(document.getElementById("todo-list-item").innerHTML),a="id title completed".split(/ /);e.exports={model:new i(new o("todomvc-vce")),renderItem:function e(t){return e._div=e._div||document.createElement("div"),e._div.innerHTML=r(t),e._div.childNodes[0]},itemSame:function(e,t){return a.every(function(n){return e[n]===t[n]})},promisify:function(e,t){return function(){var n=[].slice.call(arguments);return new Promise(function(o){n.push(o),e[t].apply(e,n)})}},ENTER_KEY:13,ESCAPE_KEY:27},VComponent.components={todo:n(4),"todo-header":n(5),"todo-footer":n(6),"todo-main":n(7),"todo-item":n(8)},VComponent.render(document).then(function(e){function t(){n.routeTo(location.hash.replace(/^[#!]+/,"")||"/")}var n=e.filter(function(e){return"todo"===e.name})[0];window.addEventListener("hashchange",t),setTimeout(t)})},function(e,t){e.exports=window.VComponent.extend({method:function(e){return this[e].bind(this)}})},function(e,t,n){"use strict";function o(e,t){if(t=t||function(){},this._dbName=e,!localStorage[e]){var n={todos:[]};localStorage[e]=JSON.stringify(n)}t.call(this,JSON.parse(localStorage[e]))}o.prototype.find=function(e,t){if(t){var n=JSON.parse(localStorage[this._dbName]).todos;t.call(this,n.filter(function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0}))}},o.prototype.findAll=function(e){e=e||function(){},e.call(this,JSON.parse(localStorage[this._dbName]).todos)},o.prototype.save=function(e,t,n){var o=JSON.parse(localStorage[this._dbName]),i=o.todos;if(t=t||function(){},n){for(var r=0;r<i.length;r++)if(i[r].id==n){for(var a in e)i[r][a]=e[a];return localStorage[this._dbName]=JSON.stringify(o),void t.call(this,[i[r]])}}else e.id=(new Date).getTime(),i.push(e),localStorage[this._dbName]=JSON.stringify(o),t.call(this,[e])},o.prototype.remove=function(e,t){for(var n=JSON.parse(localStorage[this._dbName]),o=n.todos,i=0;i<o.length;i++)if(o[i].id==e){o.splice(i,1);break}localStorage[this._dbName]=JSON.stringify(n),t.call(this,o)},o.prototype.drop=function(e){var t={todos:[]};localStorage[this._dbName]=JSON.stringify(t),e.call(this,t.todos)},e.exports=o},function(e,t,n){"use strict";function o(e){this.storage=e}o.prototype.create=function(e,t){e=e||"",t=t||function(){};var n={title:e.trim(),completed:!1};this.storage.save(n,t)},o.prototype.read=function(e,t){var n=typeof e;if(t=t||function(){},"function"===n)return t=e,this.storage.findAll(t);"string"===n||"number"===n?(e=parseInt(e,10),this.storage.find({id:e},t)):this.storage.find(e,t)},o.prototype.update=function(e,t,n){this.storage.save(t,n,e)},o.prototype.remove=function(e,t){this.storage.remove(e,t)},o.prototype.removeAll=function(e){this.storage.drop(e)},o.prototype.getCount=function(e){var t={active:0,completed:0,total:0};this.storage.findAll(function(n){n.forEach(function(e){e.completed?t.completed++:t.active++,t.total++}),e(t)})},e.exports=o},function(e,t,n){var o=n(0),i=n(1),r={"/":"all","":"all","/active":"active","/completed":"completed"};e.exports=i.extend({init:function(){var e=this;this.children.header[0].on("enter",this.method("onEnterItem")),this.followUpdate("header"),this.followUpdate("main"),this.followUpdate("footer"),this.on("update",this.method("onUpdate")),o.model.read(void 0,function(t){e.children.main[0].render(t),e.children.footer[0].render(t)})},followUpdate:function(e){this.children[e][0].on("update",this.emit.bind(this,"update",e))},routeTo:function(e){if(!r[e])return void(location.hash="/");this.children.main[0].setFilter(r[e]),this.children.footer[0].setFilter(r[e])},onEnterItem:function(e){var t=this;this.children.header[0].clear(),o.model.create(e,function(e){var n=t.children.main[0];Promise.all(e.map(n.appendItem.bind(n))).then(t.emit.bind(t,"update","header"))})},onUpdate:function(e){var t=this;o.model.read(void 0,function(n){setTimeout(function(){"header"!==e&&t.children.header[0].render(n),"main"!==e&&t.children.main[0].render(n),"footer"!==e&&t.children.footer[0].render(n)})})}})},function(e,t,n){var o=n(0);e.exports=n(1).extend({name:"header",init:function(){this.elInput=this.qs("input.new-todo")},events:["keydown blur/input.new-todo/onInput"],render:function(e){},clear:function(){this.elInput.value=""},onInput:function(e){e.keyCode&&e.keyCode!==o.ENTER_KEY||this.elInput.value&&this.emit("enter",this.elInput.value)}})},function(e,t,n){var o=n(0);e.exports=n(1).extend({name:"footer",init:function(){this.elCounter=this.qs(".todo-count"),this.elClear=this.qs(".clear-completed")},events:["click/.clear-completed/onClear"],render:function(e){function t(e){var t=e.filter(function(e){return!e.completed}).length;n.elCounter.innerHTML=1===t?"<strong>1</strong> item left":"<strong>"+t+"</strong> items left",n.root.style.display=e.length>0?"block":"none",n.elClear.style.display=e.some(function(e){return e.completed})?"block":"none"}var n=this;e?t(e):o.model.read(void 0,t)},setFilter:function(e){this.qsa("[data-route]").forEach(function(t){var n={true:"add",false:"remove"}[t.dataset.route===e];t.classList[n]("selected")})},onClear:function(){var e=this,t=!1;o.model.read(void 0,function(n){Promise.all(n.map(function(e){return e.completed?o.promisify(o.model,"remove")(e.id):void(t=!0)})).then(function(){t||(e.root.style.display="none"),e.elClear.style.display="none",e.emit("update")})})}})},function(e,t,n){function o(e,t){return"active"===t?!!e.completed:"completed"===t&&!e.completed}var i=n(0);e.exports=n(1).extend({name:"main",init:function(){this.elToggleAll=this.qs("input.toggle-all"),this.elList=this.qs("ul.todo-list")},events:["change/input.toggle-all/onToggleAll"],render:function(e){function t(e){var t={},i=[],r=(n.children.item||[]).slice();e.forEach(function(e,o){var a=r.filter(function(t){return t.getId()==e.id})[0];a?a.redraw(e):i.push(n.appendItem(e)),t[e.id]=e}),Promise.all(i).then(function(){(n.children.item||[]).slice().forEach(function(e){var i=e.getId();t[i]?o(t[i],n.filter)?e.root.classList.add("hide"):e.root.classList.remove("hide"):n.removeChild(e)}),n.root.style.display=n.children.item&&n.children.item.length>0?"block":"none",n.elToggleAll.checked=e.every(function(e){return e.completed})})}var n=this;e?t(e):i.model.read(void 0,t)},setFilter:function(e){this.filter=e,this.render()},appendItem:function(e,t){var n=this,o=i.renderItem(e);return t?this.elList.insertBefore(o,t):this.elList.appendChild(o),this.renderChildElement(o).then(function(e){return e.on("destroy update",function(){n.render(),n.emit("update")})})},onToggleAll:function(e){var t=this;i.model.read(void 0,function(n){var o=n.map(function(t){return i.promisify(i.model,"update")(t.id,{completed:e.target.checked})});Promise.all(o).then(function(){t.render(),t.emit("update")})})}})},function(e,t,n){var o=n(0);e.exports=n(1).extend({name:"item",init:function(){var e=this;o.model.read(this.getId(),function(t){e.item=t[0]})},events:["change/.toggle/onToggle","click/.destroy/onDestroy","dblclick/label/onStartEdit","keyup blur/input.edit/onEditing"],getId:function(){return this.root.dataset.itemId},redraw:function(e){(!o.itemSame(e,this.item)||e.editing||this.item.editing)&&(this.replaceRoot(o.renderItem(e)),this.item=e)},onDestroy:function(e){var t=this;o.model.remove(this.getId(),function(){t.emit("destroy")})},onToggle:function(e){var t=this;o.model.update(this.getId(),{completed:!!e.target.checked},function(e){t.redraw(e[0]),t.emit("update",e[0])})},onStartEdit:function(e){var t=this;o.model.read(this.getId(),function(e){t.redraw(Object.assign({editing:!0},e[0]));var n=t.qs("input.edit");n.value=e[0].title,n.focus()})},onEditing:function(e){var t=this;e.keyCode?e.keyCode===o.ESCAPE_KEY?(t.iscancel=!0,e.target.blur()):e.keyCode===o.ENTER_KEY&&e.target.blur():t.iscancel?(o.model.read(t.getId(),function(e){t.redraw(e[0])}),delete t.iscancel):o.model.update(t.getId(),{title:e.target.value},function(e){t.redraw(e[0]),t.emit("update",e[0])})}})}]);